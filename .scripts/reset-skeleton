#!/bin/bash -e

# Locally link js-helper
# cd packages/js-helper; yarn link; cd ../core; yarn link @pushword/js-helper; cd ../../

# Remove id lines from docs content (they are auto-generated)
find packages/docs/content -name "*.md" -exec sed -i '/^id: [0-9]*$/d' {} \;

cd packages/skeleton
rm var/app.db|| true
rm -rf media|| true
rm -rf static|| true
rm -rf /tmp/com.github.pushword.pushword/tests/var/dev/log/version|| true
cp -r media~ media

echo "Clearing cache..."
php bin/console cache:clear --no-warmup -q

echo "Creating database schema..."
php bin/console doctrine:schema:create -q

echo "Loading fixtures..."
php bin/console doctrine:fixtures:load -q

echo "Caching images..."
php bin/console pw:image:cache -q &

echo "Installing assets..."
php bin/console assets:install --symlink --relative -q &

php bin/console pw:user:create admin@example.tld p@ssword ROLE_SUPER_ADMIN