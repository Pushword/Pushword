{% extends view('/base.html.twig') %}

{# ----------- #}

{% block html_opener %}
<html lang="{{ page.locale|default(apps.get().locale) }}" {{ mergeAttr({class: 'leading-tight text-gray-900'}, page.htmlOpenerAttr|default({})) }}>
{% endblock %}

{% block title %}{{ pw(page).title|striptags }}{% endblock %}

{% block robots %}
  {% if page.searchExcerpt is defined and page.searchExcerpt is not null %}
    <meta name="description" content="{{ page.searchExcerpt|date_shortcode|escape }}">
  {% endif %}
  {% if page.metaRobots %}
    <meta name="robots" content="{{ page.metaRobots }}">
  {% endif %}
  <link rel="canonical" href="{{ page(page, true, apps.getCurrentPager()) }}">
{% endblock %}

{% block alternate_language %}
  {% if page.locale is not null %}
    <link rel="alternate" hreflang="{{ page.locale }}" href="{{ page(page, true) }}">
    {# x-default must be used only for a page where user must choose language
    {% if  page.locale == apps.get().defaultLocale %}
      <link rel="alternate" hreflang="x-default" href="{{ page(page, true) }}">
    {% endif %}#}

    {% for translation in page.translations %}
      <link rel="alternate" hreflang="{{ translation.locale }}" href="{{ page(translation, true) }}">
      {#{% if  translation.locale == apps.get().defaultLocale %}
        <link rel="alternate" hreflang="x-default" href="{{ page(translation, true) }}">
      {% endif %}#}

    {% endfor %}


  {% endif %}
{% endblock %}

{% block open_graph %}
  {#<script>const base = "{{ page('homepage') }}"</script>#}
  {# Where is `base` used ? #}

  <meta property="og:title" content="{{ page.ogTitle|default(pw(page).title)|striptags|date_shortcode }}">
  <meta property="og:url" content="{{ page(page, true) }}">
  {% if page.searchExcerpt or page.ogDescription %}
    <meta property="og:description" content="{{ page.ogDescription|default(page.searchExcerpt)|striptags|date_shortcode }}">
  {% endif %}
  {% if page.mainImage is not null %}
    <meta property="og:image" content="{{ apps.get().baseUrl|default('') }}{{ (page.mainImage)|image('default') }}">
  {% elseif apps.get().get('generated_og_image') is not null %}
    {% set generated_image = open_graph_image_generated_path(page) %}
    {% if generated_image is not null %}
      <meta property="og:image" content="{{ apps.get().baseUrl|default('') }}{{ open_graph_image_generated_path(page) }}">
      <meta name="twitter:card" content="summary_large_image">
    {% endif %}
  {% endif %}
{% endblock %}

{% block body %}
  <div class="flex flex-col min-h-screen">

  {% set pageContent = include(view('/page/_content.html.twig')) %}
  {% block content %}
    {{ pageContent|raw }}
  {% endblock %}

  {% set pageBreadcrumb = include(view('/page/_breadcrumb.html.twig')) %}
  {% block breadcrumb %}
    {{ pageBreadcrumb|raw }}
  {% endblock %}

  {% block footer %}
    {{ include(view('/page/_footer.html.twig'), {content: '"/' ~ page.slug ~ '" ' ~ pageContent ~ pageBreadcrumb}) }}
  {% endblock %}

  {% block navbar %}
    {{ include(view('/page/_navbar.html.twig')) }}
  {% endblock %}

  {% block admin_buttons %}
    {% if class_exists('\\Pushword\\Admin\\PushwordAdminBundle') and is_granted('ROLE_EDITOR') %}
      <div class="hidden md:block fixed top-1/2 right-2  mx-1 w-10 z-10 bg-gray-500 rounded-lg opacity-50">
      <a href="{{ path('admin_page_edit', {id: page.id}) }}" aria-label="{{ 'edit'|trans }}" class="inline-block p-1 text-gray-50 rounded-t-lg hover:bg-gray-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2">
        {{ svg('edit', {class: 'w-full p-2 fill-current'}) }}
      </a>
      <a href="{{ path('admin_page_list') }}?filter%5Bhost%5D%5Bvalue%5D%5B%5D={{ page.host }}" aria-label="{{ 'list'|trans }}" class="inline-block p-1 text-gray-50 bg-gray-500 hover:bg-gray-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2">
        {{ svg('list', {class: 'w-full p-2 fill-current'}) }}
      </a>
      <a href="{{ path('admin_page_create') }}?host={{ page.host }}" aria-label="{{ 'new'|trans }}" class="inline-block p-1 text-gray-50 bg-gray-500 hover:bg-gray-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2">
        {{ svg('file', {class: 'w-full p-2 fill-current'}) }}
      </a>
      <a href="{{ path('admin_static_generator', {host: page.host}) }}" aria-label="{{ 'publish'|trans }}" class="inline-block p-1 text-gray-50 bg-gray-500 rounded-b-lg hover:bg-gray-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2">
        {{ svg('upload', {class: 'w-full p-2 fill-current'}) }}
      </a>
      </div>
    {% endif %}
  {% endblock %}
  </div>
{% endblock %}

{% block html_closer %}
  </html>
{% endblock %}
